<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EZA AI V1</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Modal Popup -->
    <div id="welcomeModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeWelcomeModal()">&times;</span>
        <p>
          Jika pertanyaan nya terlalu banyak atau kompleks AI ini hanya bisa
          merender jawaban selama 10 detik. jika lebih dari itu maka akan
          terjadi error
        </p>
      </div>
    </div>

    <h1 class="color-changing-text">EZA AI BETA</h1>

    <div class="container">
      <div class="description">
        <h2>Cari jawaban dari pertanyaanmu dengan AI</h2>
        <form id="metaForm">
          <label for="title">Title:</label>
          <textarea id="title" name="title" rows="4" required></textarea>
          <button type="button" onclick="generateMeta()">Generate AI</button>
        </form>
        <div id="metaResponse"></div>

        <!-- Social Icons Section -->
        <p>Support Me:</p>
        <div class="social-icons">
          <a
            href="https://www.linkedin.com/in/ahmad-afriza-ez4-ab9173276/"
            target="_blank"
            ><img src="linkedin.png" alt="LinkedIn Icon"
          /></a>
          <a href="https://www.instagram.com/ahmdafriz4/" target="_blank"
            ><img src="instagram.png" alt="Instagram Icon"
          /></a>
        </div>

        <!-- Image Response Section -->

        <div id="imageResponse"></div>
      </div>
    </div>

    <script>
      // Add these functions to your existing <script> tag

      // Function to display the welcome modal
      function showWelcomeModal() {
        const welcomeModal = document.getElementById("welcomeModal");
        welcomeModal.style.display = "block";
      }

      // Function to close the welcome modal
      function closeWelcomeModal() {
        const welcomeModal = document.getElementById("welcomeModal");
        welcomeModal.style.display = "none";
      }

      // Call the showWelcomeModal function when the page is loaded
      window.onload = showWelcomeModal;

      async function generateMeta() {
        const title = document.getElementById("title").value;
        const metaResponseDiv = document.getElementById("metaResponse");

        try {
          // Create a new paragraph for loading message
          const loadingParagraph = document.createElement("p");
          loadingParagraph.textContent = "Loading...";
          metaResponseDiv.innerHTML = ""; // Clear previous content
          metaResponseDiv.appendChild(loadingParagraph);

          const response = await fetch(
            "https://ai-4h8z.vercel.app/openai/meta",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ title }),
            }
          );

          const result = await response.json();
          const descriptionText = result.description
            ? result.description.content
            : "No description available";

          // Update the loading paragraph with the result
          loadingParagraph.textContent = `Description: ${descriptionText}`;
        } catch (error) {
          console.error("Error generating meta data:", error);
          metaResponseDiv.innerHTML = "Error generating meta data";
        }
      }

      async function generateImage() {
        const prompt = document.getElementById("imagePrompt").value;
        const imageResponseDiv = document.getElementById("imageResponse");

        try {
          // Show loading message
          imageResponseDiv.innerHTML = "Loading...";

          const response = await fetch("http://localhost:4000/openai/image", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ prompt }),
          });

          const result = await response.json();

          if (
            result.image &&
            Array.isArray(result.image) &&
            result.image.length > 0
          ) {
            const imageResponse = result.image
              .map(
                (image) => `
                            <div>
                                <img src="${image.url}" alt="${image.revised_prompt}" style="width: 512px; height: 512px;">
                                <p>${image.revised_prompt}</p>
                            </div>`
              )
              .join("");
            imageResponseDiv.innerHTML = imageResponse;
          } else {
            imageResponseDiv.innerHTML = "No image available";
          }
        } catch (error) {
          console.error("Error fetching image:", error);
          imageResponseDiv.innerHTML = "Error fetching image";
        }
      }
    </script>
  </body>
</html>
